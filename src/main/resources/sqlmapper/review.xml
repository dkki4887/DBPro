<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.ReviewMapper">
    <resultMap id="result" type="persistence.dto.ReviewDTO">
        <result property="review_id" column="review_id"/>
        <result property="store_id" column="store_id"/>
        <result property="user_id" column="user_id"/>
        <result property="order_id" column="order_id"/>
        <result property="review_rate" column="review_rate"/>
        <result property="review_content" column="review_content"/>
        <result property="review_time" column="review_time"/>
    </resultMap>

    <select id="selectAll" resultMap="reviewResult">
        SELECT * FROM REVIEW
    </select>

    <select id="findReviewWithCustomerIdLike" resultMap="reviewResult">
        SELECT * FROM REVIEW WHERE customer_id = #{customer_id}
    </select>

    <insert id="insertReview" parameterType="ReviewDTO" useGeneratedKeys="true"
            keyProperty="review_id">
        INSERT INTO REVIEW (review_id,store_id , customer_id , order_id , contents , review_date , grade)
        values(#{review_id},#{store_id},#{customer_id},#{order_id},#{contents},#{review_date},#{grade})
    </insert>

    <select id="findPostWithTitleNameLike" resultMap="reviewResult">
        SELECT * FROM REVIEW
        WHERE hit = 0
        <if test="title != null">
            AND title like CONCAT('%',#{title},'%')
        </if>
        <if test="writer != null">
            AND writer like CONCAT('%',#{writer},'%')
        </if>
    </select>

    <select id="selectWithTrim"  resultMap="reviewResult">
        SELECT * FROM BOARD WHERE board_id = #{id}
        <trim prefix="AND (" prefixOverrides="OR" suffix=")">
            <if test="title != null">
                OR title = #{title}
            </if>
            <if test="writer != null">
                OR writer = #{writer}
            </if>
        </trim>
    </select>

</mapper>