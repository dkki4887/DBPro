<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.OrderMapper">
    <resultMap id="orderResult" type="persistence.dto.OrderDTO">
        <result property="order_id" column="order_id"/>
        <result property="user_id" column="user_id"/>
        <result property="store_id" column="store_id"/>
        <result property="order_price" column="order_price"/>
        <result property="order_payment" column="order_payment"/>
        <result property="order_state" column="order_state"/>
        <result property="order_orderTime" column="order_orderTime"/>
        <result property="order_receiveTime" column="order_receiveTime"/>
        
        <collection property="orderMenuList" resultMap="orderMenuList"/>
        <collection property="orderOptionList" resultMap="orderOptionList"/>
    </resultMap>

    <resultMap id="orderMenuList" type="persistence.dto.OrderMenuDTO">
        <result property="orderMenu_id" column="orderMenu_id"/>
        <result property="menu_name" column="menu_name"/>
        <result property="menu_price" column="menu_price"/>
    </resultMap>

    <resultMap id="orderOptionList" type="persistence.dto.OrderOptionDTO">
        <result property="orderMenu_id" column="orderMenu_id"/>
        <result property="option_name" column="option_name"/>
        <result property="option_price" column="option_price"/>
    </resultMap>

    <select id="selectAll" resultMap="orderResult">
        SELECT * FROM project.order
    </select>

    <insert id="insertOrder" parameterType="OrderDTO" useGeneratedKeys="true"
            keyProperty="order_id">
        INSERT INTO project.order (order_id , user_id , store_id , order_price , order_payment , order_state , order_orderTime , order_receiveTime)
        VALUES (#{order_id},#{user_id},#{store_id},#{order_price},#{order_payment},#{order_state},#{order_orderTime},#{order_receiveTime})
    </insert>

    <select id="selectOrder_store" resultMap="orderResult">
        SELECT user_id, menu_name, option_name, order_price, order_state
        FROM ordermenu om
        INNER JOIN project.order o
        ON om.order_id = o.order_id
        INNER JOIN orderoption oo
        ON om.orderMenu_id = oo.orderMenu_id
        WHERE o.store_id = #{store_id}
    </select>

    <select id="selectOrder_customer" resultMap="orderResult">
        SELECT user_id, menu_name, option_name, order_price, order_state
        FROM ordermenu om
        INNER JOIN project.order o
        ON om.order_id = o.order_id
        INNER JOIN orderoption oo
        ON om.orderMenu_id = oo.orderMenu_id
        WHERE o.user_id = #{user_id}
        AND (o.order_state = "배달 완료" OR o.order_state = "취소")
    </select>

</mapper>
